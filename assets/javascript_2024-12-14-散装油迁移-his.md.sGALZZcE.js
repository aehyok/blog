import{_ as r,c as o,o as t,ag as d}from"./chunks/framework.DxMCroLl.js";const p=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"javascript/2024-12-14-散装油迁移-his.md","filePath":"javascript/2024-12-14-散装油迁移-his.md","lastUpdated":1748475861000}'),a={name:"javascript/2024-12-14-散装油迁移-his.md"};function i(n,e,s,l,I,c){return t(),o("div",null,e[0]||(e[0]=[d('<p>select CAST(t.Id AS CHAR(19)) as tid, t.* from MonitorTask t where t.name like &#39;%开散装油证明%&#39;</p><h2 id="散装油-任务id-1801833127413444608" tabindex="-1">散装油 任务Id = <code>1801833127413444608</code> <a class="header-anchor" href="#散装油-任务id-1801833127413444608" aria-label="Permalink to &quot;散装油  任务Id = `1801833127413444608`&quot;">​</a></h2><p>select CAST(s.Id AS CHAR(19)) as tid, s.* from MonitorRecord s where s.MonitorTaskId = 1859829378117562368 order by s.CreatedAt desc limit 1000</p><p>select CAST(l.CurrentRegionId AS CHAR(19)) as CurrentRegionId, CAST(l.NextRegionId AS CHAR(19)) as NextRegionId, CAST(l.CurrentRoleId AS CHAR(19)) as CurrentRoleId, CAST(l.NextRoleId AS CHAR(19)) as NextRoleId from MonitorRecordLog l where l.MonitorRecordId = 1867147619353260032</p><p>select count(*) from MonitorRecordReply</p><h2 id="加油站角色id-1801831060200361984" tabindex="-1">加油站角色Id 1801831060200361984 <a class="header-anchor" href="#加油站角色id-1801831060200361984" aria-label="Permalink to &quot;加油站角色Id 1801831060200361984&quot;">​</a></h2><p>select CAST(r.Id AS CHAR(19)) as pp, r.* from Role r where r.Code like &#39;%jyz%&#39;</p><h2 id="运维管理角色-1739469981923581952" tabindex="-1">运维管理角色 1739469981923581952 <a class="header-anchor" href="#运维管理角色-1739469981923581952" aria-label="Permalink to &quot;运维管理角色 1739469981923581952&quot;">​</a></h2><p>select CAST(r.Id AS CHAR(19)) as pp, r.* from Role r where r.Code like &#39;%root%&#39;</p><h2 id="审核测试角色-1825826628824207360" tabindex="-1">审核测试角色 1825826628824207360 <a class="header-anchor" href="#审核测试角色-1825826628824207360" aria-label="Permalink to &quot;审核测试角色 1825826628824207360&quot;">​</a></h2><p>select CAST(r.Id AS CHAR(19)) as pp, r.* from Role r where r.Code =&#39;shcsjs&#39;</p><h2 id="来凤县区域id-1739469963384758272" tabindex="-1">来凤县区域Id 1739469963384758272 <a class="header-anchor" href="#来凤县区域id-1739469963384758272" aria-label="Permalink to &quot;来凤县区域Id 1739469963384758272&quot;">​</a></h2><p>select * from Region w where w.Id = 1739469963384758272</p><h2 id="三坝村区域id-1822103466693234688" tabindex="-1">三坝村区域Id 1822103466693234688 <a class="header-anchor" href="#三坝村区域id-1822103466693234688" aria-label="Permalink to &quot;三坝村区域Id 1822103466693234688&quot;">​</a></h2><p>select CAST(w.Id AS CHAR(19)) as pp, w.* from Region w where w.Name like &#39;%三坝村村民委员会%&#39;</p><h2 id="散装油老任务的id-1801833127413444608" tabindex="-1">散装油老任务的Id=1801833127413444608 <a class="header-anchor" href="#散装油老任务的id-1801833127413444608" aria-label="Permalink to &quot;散装油老任务的Id=1801833127413444608&quot;">​</a></h2><h2 id="散装油新任务的id-1859829378117562368" tabindex="-1">散装油新任务的Id = 1859829378117562368 <a class="header-anchor" href="#散装油新任务的id-1859829378117562368" aria-label="Permalink to &quot;散装油新任务的Id = 1859829378117562368&quot;">​</a></h2><p>select CAST(t.Id AS CHAR(19)) as tid, t.* from MonitorTask t where t.Id = 1859829378117562368</p><h2 id="" tabindex="-1"><a class="header-anchor" href="#" aria-label="Permalink to &quot;&quot;">​</a></h2><p>select * from MonitorRecord r where r.MonitorTaskId = 1859829378117562368</p><h2 id="将历史数据修改为已删除" tabindex="-1">将历史数据修改为已删除 <a class="header-anchor" href="#将历史数据修改为已删除" aria-label="Permalink to &quot;将历史数据修改为已删除&quot;">​</a></h2><p>update MonitorRecord set IsDeleted = 1 where MonitorTaskId = 1859829378117562368 ---1801833127413444608</p><h2 id="区域id-1822102519103492096-蓝河村村民委员会" tabindex="-1">区域Id 1822102519103492096 蓝河村村民委员会 <a class="header-anchor" href="#区域id-1822102519103492096-蓝河村村民委员会" aria-label="Permalink to &quot;区域Id 1822102519103492096  蓝河村村民委员会&quot;">​</a></h2><p>select * from Region where Id = 1822102519103492096</p><h2 id="批量插入填报记录数据" tabindex="-1">批量插入填报记录数据 <a class="header-anchor" href="#批量插入填报记录数据" aria-label="Permalink to &quot;批量插入填报记录数据&quot;">​</a></h2><p>INSERT INTO MonitorRecord ( Id ,MonitorTaskId ,WriteStatus ,RegionId ,UserId ,IsDeleted ,CreatedAt ,CreatedBy ,UpdatedAt ,UpdatedBy ,Remark ,BusinessFormId ,OpenId ,IsAnonymous ) SELECT Id+1 ,1859829378117562368 ,WriteStatus ,RegionId ,UserId ,IsDeleted ,CreatedAt ,CreatedBy ,UpdatedAt ,UpdatedBy ,Remark ,BusinessFormId ,OpenId ,IsAnonymous FROM MonitorRecord WHERE MonitorTaskId = 1801833127413444608</p><h2 id="批量插入填报回复记录数据" tabindex="-1">批量插入填报回复记录数据 <a class="header-anchor" href="#批量插入填报回复记录数据" aria-label="Permalink to &quot;批量插入填报回复记录数据&quot;">​</a></h2><p>INSERT INTO MonitorRecordLog ( Id ,MonitorRecordId ,IsHistory ,WriteStatus ,IsDeleted ,CreatedAt ,CreatedBy ,UpdatedAt ,UpdatedBy ,Remark ,CurrentRegionId ,CurrentRoleId ,NextRegionId ,NextRoleId ,AuditContent ,AuditMediaIds ) SELECT Id ,MonitorRecordId+1 , 0 , 2 ,IsDeleted ,CreatedAt ,CreatedBy ,UpdatedAt ,UpdatedBy ,Remark ,RegionId ,0 ,0 ,0 ,ReplyContent ,ReplyMediaIds FROM MonitorRecordReply</p><p>查找到所有的加油站角色，区域审核数据 select * from MonitorRecordLog l where l.CurrentRegionId = 1739469963384758272</p><p>将加油站审核数据进行批量修改（确定加油站审核角色） update MonitorRecordLog set WriteStatus = 3, CurrentRoleId = 1739469981923581952, BusinessName = &#39;加油审核&#39; where CurrentRegionId = 1739469963384758272</p><h2 id="查看所有非加油站角色数据-村委审核数据" tabindex="-1">查看所有非加油站角色数据，村委审核数据 <a class="header-anchor" href="#查看所有非加油站角色数据-村委审核数据" aria-label="Permalink to &quot;查看所有非加油站角色数据，村委审核数据&quot;">​</a></h2><p>select * from MonitorRecordLog l where l.CurrentRegionId != 1739469963384758272</p><p>update MonitorRecordLog set WriteStatus = 5, CurrentRoleId = 1825826628824207360, BusinessName = &#39;村委审核&#39; where CurrentRegionId != 1739469963384758272</p><p>INSERT INTO datareport_1859829378750902272 ( id, taskid, c1, c2, c3, c4, createby, updateby, createtime, updatetime ) SELECT id, taskid, c1, c2, c3, c4, createby, updateby, createtime, updatetime FROM datareport_1801833127438610432</p><p>修改其中taskid</p><p>update MonitorTask set Id = 1859829378117562368 where Id = 1859829378117562368</p><h2 id="需要继续处理的-先查询再修改" tabindex="-1">需要继续处理的（先查询再修改） <a class="header-anchor" href="#需要继续处理的-先查询再修改" aria-label="Permalink to &quot;需要继续处理的（先查询再修改）&quot;">​</a></h2><p>update MonitorRecord set MonitorTaskId = 1859829378117562368 where MonitorTaskId = 1859829378117562369</p><hr><p>1月4日处理数据逻辑</p><p>select * from MonitorTask t where t.Id = 1859829378117562368</p><p>INSERT INTO MonitorRecord ( Id ,MonitorTaskId ,WriteStatus ,RegionId ,UserId ,IsDeleted ,CreatedAt ,CreatedBy ,UpdatedAt ,UpdatedBy ,Remark ,BusinessFormId ,OpenId ,IsAnonymous ) SELECT Id+1 ,1859829378117562368 ,WriteStatus ,RegionId ,UserId ,IsDeleted ,CreatedAt ,CreatedBy ,UpdatedAt ,UpdatedBy ,Remark ,BusinessFormId ,OpenId ,IsAnonymous FROM MonitorRecord WHERE MonitorTaskId = 1801833127413444608</p><p>INSERT INTO MonitorRecordLog ( Id ,MonitorRecordId ,IsHistory ,WriteStatus ,IsDeleted ,CreatedAt ,CreatedBy ,UpdatedAt ,UpdatedBy ,Remark ,CurrentRegionId ,CurrentRoleId ,NextRegionId ,NextRoleId ,AuditContent ,AuditMediaIds ) SELECT Id ,MonitorRecordId+1 , 0 , 2 ,IsDeleted ,CreatedAt ,CreatedBy ,UpdatedAt ,UpdatedBy ,Remark ,RegionId ,0 ,0 ,0 ,ReplyContent ,ReplyMediaIds FROM MonitorRecordReply</p><p>select * from Region w where w.Id = 1739469963384758272</p><h2 id="第一种情况" tabindex="-1">第一种情况 <a class="header-anchor" href="#第一种情况" aria-label="Permalink to &quot;第一种情况&quot;">​</a></h2><h2 id="_1、-5677条记录有加油站的审核记录-但存在一些记录是被删除的" tabindex="-1">1、 5677条记录有加油站的审核记录(但存在一些记录是被删除的) <a class="header-anchor" href="#_1、-5677条记录有加油站的审核记录-但存在一些记录是被删除的" aria-label="Permalink to &quot;1、 5677条记录有加油站的审核记录(但存在一些记录是被删除的)&quot;">​</a></h2><p>select * from MonitorRecordLog l where l.CurrentRegionId = 1739469963384758272</p><p>##1、 将这写加油站审核记录的数据进行处理(5677条记录) update MonitorRecordLog set WriteStatus = 3, IsHistory = 0, CurrentRoleId = 1739469981923581952, BusinessName = &#39;加油审核&#39; where CurrentRegionId = 1739469963384758272</p><p>##1、 修改5677条的状态（MonitorRecord） select * from MonitorRecord r where r.Id in (select l.MonitorRecordId from MonitorRecordLog l where l.CurrentRegionId = 1739469963384758272)</p><p>##1、 修改成功受影像记录 5471 update MonitorRecord set WriteStatus = 3 where Id in (select l.MonitorRecordId from MonitorRecordLog l where l.CurrentRegionId = 1739469963384758272)</p><p>##1、 再将村委记录进行修改(6128) select * from MonitorRecordLog l where l.MonitorRecordId in (select l.MonitorRecordId from MonitorRecordLog l where l.CurrentRegionId = 1739469963384758272) and l.CurrentRegionId !=1739469963384758272</p><p>order by l.MonitorRecordId desc;</p><h2 id="_1、村委记录-ishistory-1" tabindex="-1">1、村委记录 IsHistory =1 <a class="header-anchor" href="#_1、村委记录-ishistory-1" aria-label="Permalink to &quot;1、村委记录 IsHistory =1&quot;">​</a></h2><h2 id="_1、修改村委记录是6128条" tabindex="-1">1、修改村委记录是6128条 <a class="header-anchor" href="#_1、修改村委记录是6128条" aria-label="Permalink to &quot;1、修改村委记录是6128条&quot;">​</a></h2><p>update MonitorRecordLog set WriteStatus = 5, IsHistory=1, CurrentRoleId = 1825826628824207360, BusinessName = &#39;村委审核&#39;, NextRoleId=1739469981923581952, NextRegionId=1739469963384758272 where MonitorRecordId in (select l.MonitorRecordId from MonitorRecordLog l where l.CurrentRegionId = 1739469963384758272) and CurrentRegionId !=1739469963384758272</p><h2 id="_2、第二种情况只有村委上报记录的" tabindex="-1">2、第二种情况只有村委上报记录的 <a class="header-anchor" href="#_2、第二种情况只有村委上报记录的" aria-label="Permalink to &quot;2、第二种情况只有村委上报记录的&quot;">​</a></h2><p>select * from MonitorRecordLog l where l.MonitorRecordId not in (select l.MonitorRecordId from MonitorRecordLog l where l.CurrentRegionId = 1739469963384758272)</p><p>select * from Role where Id = 1825826628824207360</p><p>update MonitorRecordLog set WriteStatus = 5, IsHistory=0, CurrentRoleId = 1825826628824207360, BusinessName = &#39;村委审核&#39;, NextRoleId=1739469981923581952, NextRegionId=1739469963384758272 where MonitorRecordId not in (select l.MonitorRecordId from MonitorRecordLog l where l.CurrentRegionId = 1739469963384758272)</p><h2 id="修改monitorrecord记录-状态" tabindex="-1">修改MonitorRecord记录 状态 <a class="header-anchor" href="#修改monitorrecord记录-状态" aria-label="Permalink to &quot;修改MonitorRecord记录 状态&quot;">​</a></h2><p>select * from MonitorRecord r where r.Id not in (select l.MonitorRecordId from MonitorRecordLog l where l.CurrentRegionId = 1739469963384758272) and r.Id in (select MonitorRecordId from MonitorRecordLog l)<br> and r.MonitorTaskId = 1859829378117562368</p><p>select r.Id from MonitorRecord r inner join MonitorRecordLog l on r.Id = l.MonitorRecordId where r.MonitorTaskId = 1859829378117562368 and not exists ( select 1 from MonitorRecordLog ll where ll.MonitorRecordId = r.Id and ll.CurrentRegionId = 1739469963384758272 )</p><p>update MonitorRecord r set r.WriteStatus = 5 where r.Id in ( select r.Id from MonitorRecord r inner join MonitorRecordLog l on r.Id = l.MonitorRecordId where r.MonitorTaskId = 1859829378117562368 and not exists ( select 1 from MonitorRecordLog ll where ll.MonitorRecordId = r.Id and ll.CurrentRegionId = 1739469963384758272 ) )</p><h2 id="第三种情况-只需要插入村民的提交信息" tabindex="-1">第三种情况 只需要插入村民的提交信息 <a class="header-anchor" href="#第三种情况-只需要插入村民的提交信息" aria-label="Permalink to &quot;第三种情况 只需要插入村民的提交信息&quot;">​</a></h2><p>select * from MonitorRecord r where r.RegionId =1859829378117562368 order by CreatedAt desc;</p><p>select r.name,mr.RegionId,mr.* FROM MonitorRecord mr inner join Region r on r.Id = mr.RegionId where Id not in (select l.MonitorRecordId from MonitorRecordLog l ) and MonitorTaskId = 1859829378117562368</p><p>order by RegionId desc group by RegionId HAVING count(*)&gt;1</p><p>select regionId FROM MonitorRecord where Id not in (select l.MonitorRecordId from MonitorRecordLog l ) and MonitorTaskId = 1859829378117562368 group by regionId having count(*)&gt;3</p><p>select CAST(l.MonitorRecordId as CHAR(19)) TID from MonitorRecordLog l where l.MonitorRecordId not in ( select Id from MonitorRecord l where l.Id in (select MonitorRecordId from MonitorRecordLog l where l.CurrentRegionId = 1739469963384758272) and l.MonitorTaskId = 1859829378117562368 ) and l.CurrentRegionId = 1739469963384758272</p><p>select * from MonitorRecord r where r.Id in (1829007816653041665)</p><p>select * from MonitorRecordLog l where l.MonitorRecordId = 1829007816653041665</p><p>select CAST(u.Id as CHAR(19)) TID from User u where u.RealName=&#39;胡秀付&#39;</p><p>select CAST(r.Id as CHAR(19)) TID, r.* from MonitorRecord r where r.UserId = 1808697396352389120</p><p>select * from MonitorRecordLog l where l.MonitorRecordId in (1857240272778850305)</p><h2 id="最后一种修改没有提交记录的" tabindex="-1">最后一种修改没有提交记录的 <a class="header-anchor" href="#最后一种修改没有提交记录的" aria-label="Permalink to &quot;最后一种修改没有提交记录的&quot;">​</a></h2><p>select r.name,mr.RegionId FROM MonitorRecord mr inner join Region r on r.Id = mr.RegionId where mr.MonitorTaskId = 1859829378117562368</p><p>select CAST(mr.RegionId as CHAR(19)) from MonitorRecord mr where mr.Id not in (select l.MonitorRecordId from MonitorRecordLog l) and mr.MonitorTaskId = 1859829378117562368 and mr.WriteStatus = 99 order by mr.RegionId desc;</p><p>INSERT INTO MonitorRecordLog ( Id ,MonitorRecordId ,IsHistory ,WriteStatus ,IsDeleted ,CreatedAt ,CreatedBy ,UpdatedAt ,UpdatedBy ,Remark ,CurrentRegionId ,CurrentRoleId ,NextRegionId ,NextRoleId ,AuditContent ,AuditMediaIds ,BusinessName ) SELECT Id ,Id , 0 , 2 ,IsDeleted ,CreatedAt ,CreatedBy ,UpdatedAt ,UpdatedBy ,Remark ,RegionId ,1739469981923581954 ,RegionId ,1825826628824207360 ,&#39;&#39; ,&#39;&#39; ,&#39;村委审核&#39; from MonitorRecord mr where mr.Id not in (select l.MonitorRecordId from MonitorRecordLog l) and mr.MonitorTaskId = 1859829378117562368 and mr.WriteStatus = 99</p><p>update MonitorRecordLog set BusinessName = &#39;村委审核&#39; where BusinessName is null</p><p>select * from MonitorRecordLog s where s.BusinessName is null</p><p>select * from MonitorRecord mr where mr.MonitorTaskId = 1859829378117562368 and mr.WriteStatus = 99</p><p>update MonitorRecord mr set mr.WriteStatus = 2 where mr.MonitorTaskId = 1859829378117562368 and mr.WriteStatus = 99</p><p>select CAST(r.Id as CHAR(19)) TID from Region r where r.Id = 1739469963384758272</p><p>select CAST(r.ParentId as CHAR(19)) from Region r where r.Id = 1822105194851340288</p><p>select * from Region r where r.Id in(1822105194851340288,1742464896978915328)</p><p>select * from Role r where r.Id in(1825826628824207360,1739469981923581954)</p><p>select CAST(r.Id as CHAR(19)) TID from Role r where r.Name like &#39;%村民%&#39;</p>',87)]))}const h=r(a,[["render",i]]);export{p as __pageData,h as default};
