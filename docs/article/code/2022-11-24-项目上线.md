## 前言
最近正在做的项目上线了，问题很多，有前端的问题也有后端的问题。这里就简单的总结一下。

## 前端

先说一下前端的问题，这里对代码的探讨不做过多的展示，主要简单说明一下技术的实现方案。

#### 技术选型问题
h5嵌套到小程序的webview,但是又要用到小程序里的地图定位，就需要由H5跳转到小程序的页面，然后要由小程序页面返回到webview中的h5,这里还需要有一个返回值传到h5中，这里我暂时没想到办法，至少我没想到办法回传数据，于是只能简单的写个定时器，不断的通过接口调用，相当于数据的回传刷新了。

这里如果完全是小程序的页面就不会存在这个问题了，不过水饺咱没时间全部用小程序的页面呢？

#### 表单重复提交问题
由于项目中主要的就是数据的录入，所以出问题最多的就是在表单多次提交，其实也有很多的方法。
- 方法一： 按钮提交时，将按钮设置为加载状态，并不可点击。
- 方法二： 通过pinia保存状态数据，点击保存时对比数据，数据如果未被修改，则不调用接口保存，有效的减少了服务器写入数据的压力。

#### 缓存问题
由于是h5嵌套到webView的小程序中的，所以有时候明明更新了前端，用户却还是之前的版本，这里想到的办法就是通过nginx 配置 缓存
```
location /{
    alias /usr/local/xxxx;
    index index.html;
    add_header Cache-Control no-cache;
}
```
no-cache 协商缓存，每次也去服务器请求，但会进行判断是否是新的资源，如果是旧的资源，则直接返回304使用客户端的缓存。

no-store 相当于每次请求都会从服务器获取前端页面，不会进行缓存。

#### 其他
当然还存在其他一些小问题，比如用户操作便利性的改进，以及友好的错误提示 等等。

## 后端
由于我也参与了一些后端接口的工作，对整个前后端的情况都有所了解。

#### 重复数据

由于前期时间确实比较紧张，准备不足，导致程序存在一些问题，经过排查发现，在导入数据的时候没有判断数据的唯一性，导致数据重复。这个算是一个bug，目前已经修复了。
#### 数据延迟

由于高峰期存在接口10秒都没有提交成功的情况，后来发现mysql事务中的查询存在比较大的耗时，经过调整添加索引修改查询条件，不进行全表扫描，目前观察不存在事务高峰期数据并发导致Mysql数据库CPU拉满的情况。

#### 日志处理

应用中存在记录日志文件过大，并发量大的时候，导致频繁插入，而且文件越大插入速度必然很慢，这里做了文件大小限制，将大小设置未10M，很小了，速度非常快。并且在应用中对日志类型也就是写入日志的频次进行 修改，没有必要的日志进行了移除。

#### 用户身份
通过调试发现，每次接口调用，用户身份信息都会重新获取，而且要请求mysql，这个看了一下并不是那么容易处理，暂时还没解决。这里可以进行缓存处理，但是发现有一点复杂，后面有时候肯定还是要处理的。

## 总结

最近刚好在重装自己的办公电脑，以及个人华为云服务器，


- linux磁盘挂载问题
- mysql数据备份问题
- 服务器扩容前的处理事项、应用备份、以及相关配置文件
- 服务器扩容后的检查工作、磁盘状态、应用、数据库、redis等正常使用
 